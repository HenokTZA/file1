{% extends "base.html" %}
{% block content %}

<div class="container-fluid px-4">
  <h2 class="mb-4 fw-bold text-dark">Owner Control Panel</h2>

  {# ===== Row 1 –– Account-type totals ===== #}
  <div class="row g-4 mb-4">
    <div class="col-md-6">
      <div class="card shadow-sm border-start border-primary border-4">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-uppercase text-muted fw-semibold small">Personal Accounts</h6>
              <h2 class="mb-0 fw-bold">{{ stats.personal_total }}</h2>
            </div>
            <div class="bg-primary bg-opacity-10 p-3 rounded">
              <i class="fas fa-user text-primary fs-4"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card shadow-sm border-start border-success border-4">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-uppercase text-muted fw-semibold small">Organization Accounts</h6>
              <h2 class="mb-0 fw-bold">{{ stats.org_total }}</h2>
            </div>
            <div class="bg-success bg-opacity-10 p-3 rounded">
              <i class="fas fa-building text-success fs-4"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  {# ===== Row 2 –– Personal plan breakdown ===== #}
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-white border-0 py-3">
      <h5 class="mb-0 fw-semibold text-dark">Personal Plans Breakdown</h5>
    </div>
    <div class="card-body pt-0">
      <div class="row row-cols-2 row-cols-md-4 g-3">
        {% set p = stats.personal %}
        {% for plan, label, color in
            [('free','Free','#6c757d'),
             ('basic','Basic','#0d6efd'),
             ('pro','Pro','#6610f2'),
             ('none','None','#adb5bd')] %}
          <div class="col">
            <div class="card border-0 shadow-sm h-100">
              <div class="card-body text-center py-4">
                <div class="mb-3">
                  <span class="badge rounded-pill py-2 px-3" style="background-color: {{ color }}; color: white;">
                    {{ label }}
                  </span>
                </div>
                <h3 class="fw-bold mb-0">{{ p[plan] }}</h3>
                <small class="text-muted">accounts</small>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  {# ===== Row 3 –– Organization plan breakdown ===== #}
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-white border-0 py-3">
      <h5 class="mb-0 fw-semibold text-dark">Organization Plans Breakdown</h5>
    </div>
    <div class="card-body pt-0">
      <div class="row row-cols-2 row-cols-md-5 g-3">
        {% set o = stats.organization %}
        {% for plan, label, color in
            [('free','Free','#6c757d'),
             ('basic','Basic','#0d6efd'),
             ('pro','Pro','#6610f2'),
             ('enterprise','Enterprise','#198754'),
             ('none','None','#adb5bd')] %}
          <div class="col">
            <div class="card border-0 shadow-sm h-100">
              <div class="card-body text-center py-4">
                <div class="mb-3">
                  <span class="badge rounded-pill py-2 px-3" style="background-color: {{ color }}; color: white;">
                    {{ label }}
                  </span>
                </div>
                <h3 class="fw-bold mb-0">{{ o[plan] }}</h3>
                <small class="text-muted">accounts</small>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  {# ===== Subscriber table ===== #}
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-white border-0 py-3 d-flex justify-content-between align-items-center">
      <h5 class="mb-0 fw-semibold text-dark">Subscribers</h5>
      <div class="d-flex">
        <input type="text" class="form-control form-control-sm me-2" placeholder="Search..." id="searchInput">
        <button class="btn btn-sm btn-outline-secondary">
          <i class="fas fa-download"></i> Export
        </button>
      </div>
    </div>
    <div class="card-body px-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0" id="subscribersTable">
          <thead class="table-light">
            <tr>
              <th class="ps-4">#</th>
              <th>Name</th>
              <th>Email</th>
              <th>Account Type</th>
              <th>Subscription</th>
              <th>Max Users</th>
              <th>Max Resources</th>
              <th class="pe-4">Joined</th>
            </tr>
          </thead>
          <tbody>
            {% for s in subscribers %}
              <tr>
                <td class="ps-4">{{ loop.index }}</td>
                <td class="fw-semibold">{{ s.first_name }} {{ s.last_name }}</td>
                <td><a href="mailto:{{ s.email }}" class="text-primary">{{ s.email }}</a></td>
                <td><span class="badge bg-light text-dark">{{ s.account_type.title() }}</span></td>
                <td>
                  {% if s.subscription_type %}
                    <span class="badge 
                      {% if s.subscription_type == 'pro' %}bg-primary
                      {% elif s.subscription_type == 'enterprise' %}bg-success
                      {% elif s.subscription_type == 'basic' %}bg-info
                      {% else %}bg-secondary{% endif %}">
                      {{ s.subscription_type.title() }}
                    </span>
                  {% else %}
                    —
                  {% endif %}
                </td>
                <td>{{ s.max_users or '—' }}</td>
                <td>{{ s.max_resources or '—' }}</td>
                <td>{{ s.created_at.strftime('%Y-%m-%d') }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <div class="card-footer bg-white border-0 py-3">
      <nav aria-label="Table navigation">
        <ul class="pagination justify-content-center mb-0">
          <li class="page-item disabled">
            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
          </li>
          <li class="page-item active"><a class="page-link" href="#">1</a></li>
          <li class="page-item"><a class="page-link" href="#">2</a></li>
          <li class="page-item"><a class="page-link" href="#">3</a></li>
          <li class="page-item">
            <a class="page-link" href="#">Next</a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

{% endblock %}
